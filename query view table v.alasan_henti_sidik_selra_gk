create view alasan_henti_sidik_selra_gk as
SELECT fromdate, todate,  col as alasan_perkara_dihentikan, [Polda Aceh] polda_aceh, [POLDA BALI] polda_bali, [POLDA BANTEN] polda_banten, [POLDA BENGKULU] polda_bengkulu, [Polda D.I Yogyakarta] polda_diy, [POLDA GORONTALO] polda_gorontalo, [POLDA JAMBI] polda_jambi, 
[POLDA JAWA BARAT] polda_jabar, [POLDA JAWA TENGAH] polda_jateng, [POLDA JAWA TIMUR] polda_jatim, [POLDA KALIMANTAN BARAT] polda_kalbar, 
[POLDA KALIMANTAN SELATAN] polda_kalsel, [POLDA KALIMANTAN TENGAH] polda_kalteng, [POLDA KALIMANTAN TIMUR] as polda_kaltim, [POLDA KALIMANTAN UTARA] as polda_kalut, [Polda Bangka Belitung] as polda_babel, [POLDA KEPULAUAN RIAU] as polda_kepri, [POLDA LAMPUNG] as polda_lampung, [POLDA MALUKU] as polda_maluku, [POLDA MALUKU UTARA] as polda_malut, [POLDA METRO JAYA] as polda_metrojaya, [POLDA NUSA TENGGARA BARAT] as polda_ntb, [POLDA NUSA TENGGARA TIMUR] as polda_ntt, [POLDA PAPUA] as polda_papua, [POLDA PAPUA BARAT] as polda_papuabarat, [POLDA RIAU] as polda_riau, [POLDA SULAWESI BARAT] as polda_sulbar, [POLDA SULAWESI SELATAN] as polda_sulsel, [POLDA SULAWESI TENGAH] as polda_sulteng, [POLDA SULAWESI TENGGARA] as polda_sultara, [POLDA SULAWESI UTARA] as polda_sulut, [POLDA SUMATERA BARAT] as polda_sumbar, [POLDA SUMATERA SELATAN] as polda_sumsel, [POLDA SUMATERA UTARA] as polda_sumut,
([POLDA ACEH]+[POLDA BALI]+[POLDA BANTEN]+[POLDA BENGKULU]+[Polda D.I Yogyakarta]+[POLDA GORONTALO]+[POLDA JAMBI]+[POLDA JAWA BARAT]+[POLDA JAWA TENGAH]+[POLDA JAWA TIMUR]+[POLDA KALIMANTAN BARAT]+[POLDA KALIMANTAN SELATAN]+[POLDA KALIMANTAN TENGAH]+[POLDA KALIMANTAN TIMUR]+[POLDA KALIMANTAN UTARA]+[Polda Bangka Belitung]+[POLDA KEPULAUAN RIAU]+[POLDA LAMPUNG]+[POLDA MALUKU]+[POLDA MALUKU UTARA]+[POLDA METRO JAYA]+[POLDA NUSA TENGGARA BARAT]+[POLDA NUSA TENGGARA TIMUR]+[POLDA PAPUA]+[POLDA PAPUA BARAT]+[POLDA RIAU]+[POLDA SULAWESI BARAT]+[POLDA SULAWESI SELATAN]+[POLDA SULAWESI TENGAH]+[POLDA SULAWESI TENGGARA]+[POLDA SULAWESI UTARA]+[POLDA SUMATERA BARAT]+[POLDA SUMATERA SELATAN]+[POLDA SUMATERA UTARA]) as TOTAL

FROM
(
SELECT fromdate, todate, NAMA_SATKER, col, alasan
FROM [SOPS.EWS.IntegrationData].[dbo].[bareskrim_rekap_selra_] 
unpivot
(
	alasan
	For col in (BUKAN_PERKARA_PIDANA_SIDIK, NEBIS_IN_IDEM_SIDIK, TERSANGKA_MATI_SIDIK, TERSANGKA_GILA_SIDIK, RESTORASI_JUSTICE_SIDIK, TIDAK_CUKUP_BUKTI_SIDIK, KADALUARSA_SIDIK
)
	) unpin
) src 
PIVOT
(
	max(alasan)
	for [NAMA_SATKER] in ([POLDA ACEH], [POLDA BALI], [POLDA BANTEN], [POLDA BENGKULU], [Polda D.I Yogyakarta], [POLDA GORONTALO], [POLDA JAMBI], [POLDA JAWA BARAT], [POLDA JAWA TENGAH], [POLDA JAWA TIMUR], [POLDA KALIMANTAN BARAT], [POLDA KALIMANTAN SELATAN], [POLDA KALIMANTAN TENGAH], [POLDA KALIMANTAN TIMUR], [POLDA KALIMANTAN UTARA],
[Polda Bangka Belitung], [POLDA KEPULAUAN RIAU], [POLDA LAMPUNG], [POLDA MALUKU], [POLDA MALUKU UTARA], [POLDA METRO JAYA], [POLDA NUSA TENGGARA BARAT], [POLDA NUSA TENGGARA TIMUR], [POLDA PAPUA], [POLDA PAPUA BARAT], [POLDA RIAU], [POLDA SULAWESI BARAT], [POLDA SULAWESI SELATAN], [POLDA SULAWESI TENGAH], [POLDA SULAWESI TENGGARA], [POLDA SULAWESI UTARA], [POLDA SUMATERA BARAT], [POLDA SUMATERA SELATAN], [POLDA SUMATERA UTARA])
) AS pivv
order by fromdate desc
